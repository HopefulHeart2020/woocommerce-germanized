!function(p,s){function e(e){var r=this;r.$form=e,r.params=wc_gzd_unit_price_observer_params,r.$wrapper=e.closest(r.params.wrapper),r.$product=e.closest(".product"),r.requests=[],r.observer={},r.timeout=!1,r.$wrapper.length<=0&&(r.$wrapper=r.$product),("MutationObserver"in s||"WebKitMutationObserver"in s||"MozMutationObserver"in s)&&(r.$form.addClass("has-unit-price-observer"),r.initObserver(r),e.hasClass("variations_form")?(r.productId=0<e.find("input[name=product_id]").length?e.find("input[name=product_id]").val():e.data("product_id"),r.variationId=0<e.find("input[name=variation_id]").length?e.find("input[name=variation_id]").val():0,e.find("input[name=variation_id]").length<=0&&(r.variationId=0<e.find("input.variation_id").length?e.find("input.variation_id").val():0),e.on("reset_data",{GermanizedUnitPriceObserver:r},r.onResetVariation),e.on("found_variation.wc-variation-form",{GermanizedUnitPriceObserver:r},r.onFoundVariation)):r.productId=0<e.find("*[name=add-to-cart][type=submit]").length?e.find("*[name=add-to-cart][type=submit]").val():r.params.product_id)}e.prototype.getPriceNode=function(e,r,t){t=void 0!==t&&t;r=e.$wrapper.find(r+":not(.price-unit):visible:last");return r=t&&r.length<=0&&e.$form.hasClass("variations_form")?e.$wrapper.find(".woocommerce-variation-price span.price:not(.price-unit):visible:last"):r},e.prototype.initObserver=function(o){0===Object.keys(o.observer).length&&p.each(o.params.price_selector,function(t,i){var e,n=!!i.hasOwnProperty("is_primary_selector")&&i.is_primary_selector,r=o.getPriceNode(o,t,n),a=!1;0<r.length&&(e=function(e,r){o.timeout&&(clearTimeout(o.timeout),o.abortAjaxRequests(o)),o.timeout=setTimeout(function(){var e=o.getCurrentPriceData(o,t,i.is_total_price,n);e&&p.active<=0&&o.refreshUnitPrice(o,e.price,e.unit_price,e.sale_price,e.quantity)},500)},"MutationObserver"in s?a=new s.MutationObserver(e):"WebKitMutationObserver"in s?a=new s.WebKitMutationObserver(e):"MozMutationObserver"in s&&(a=new s.MozMutationObserver(e)),a&&(o.observer[t]=a,o.observer[t].observe(r[0],{childList:!0,subtree:!0,characterData:!0})))})},e.prototype.cancelObserver=function(e){if(0<e.observer.length)for(var r in e.observer)e.observer.hasOwnProperty(r)&&(e.observer[r].disconnect(),delete e.observer[r])},e.prototype.abortAjaxRequests=function(e){if(0<e.requests.length)for(var r=0;r<e.requests.length;r++)e.requests[r].abort()},e.prototype.onResetVariation=function(e){e.data.GermanizedUnitPriceObserver.variationId=0},e.prototype.onFoundVariation=function(e,r){e=e.data.GermanizedUnitPriceObserver;r.hasOwnProperty("variation_id")&&(e.variationId=r.variation_id),e.initObserver(e)},e.prototype.getCurrentPriceData=function(e,r,t,i){var n=e.getPriceNode(e,r,i);if(0<n.length){var a=n.parents(e.params.wrapper).find(".price-unit:first"),o="",s=n.find(".amount:first"),r=p(e.params.wrapper+" "+e.params.qty_selector+":first"),i=1;0<r.length&&(i=parseFloat(r.val())),s.length<=0&&(s=0<n.find(".price").length?n.find(".price"):n);s=e.getRawPrice(s,e.params.price_decimal_sep);if(1<n.find(".amount").length&&(o=e.getRawPrice(n.find(".amount:last"),e.params.price_decimal_sep)),0<a.length&&s)return t&&(s=parseFloat(s)/i,0<o.length&&(o=parseFloat(o)/i)),{price:s,unit_price:a,sale_price:o,quantity:i}}return!1},e.prototype.getCurrentProductId=function(e){var r=e.productId;return 0<e.variationId&&(r=e.variationId),parseInt(r)},e.prototype.getRawPrice=function(r,e){var t=0<r.length?r.text():"",r=!1;try{r=accounting.unformat(t,e)}catch(e){r=!1}return r},e.prototype.refreshUnitPrice=function(r,e,t,i,n){r.abortAjaxRequests(r),r.requests.push(p.ajax({type:"POST",url:r.params.wc_ajax_url.toString().replace("%%endpoint%%","gzd_refresh_unit_price"),data:{security:r.params.refresh_unit_price_nonce,product_id:r.getCurrentProductId(r),price:e,price_sale:i,quantity:n},success:function(e){parseInt(e.product_id)===r.getCurrentProductId(r)&&e.hasOwnProperty("unit_price_html")&&t.html(e.unit_price_html)},error:function(e){},dataType:"json"}))},p.fn.wc_germanized_unit_price_observer=function(){return new e(this),this},p(function(){"undefined"!=typeof wc_gzd_unit_price_observer_params&&p(".variations_form, "+wc_gzd_unit_price_observer_params.wrapper+" form.cart").each(function(){p(this).wc_germanized_unit_price_observer()})})}(jQuery,window,document),window.germanized=window.germanized||{};