!function(n,i){function e(e){var r=this;r.$form=e,r.params=wc_gzd_single_product_params,r.$wrapper=e.closest(wc_gzd_single_product_params.wrapper),r.$product=e.closest(".product"),r.requests=[],r.$wrapper.length<=0&&(r.$wrapper=r.$product),r.$wrapper.find(r.params.price_selector+":not(.price-unit):visible").on("DOMSubtreeModified",{GermanizedSingleProductWatcher:r},r.onChangePrice),e.hasClass("variations_form")?(r.productId=0<e.find("input[name=product_id]").length?e.find("input[name=product_id]").val():r.params.product_id,r.variatonId=0<e.find("input[name=variation_id]").length?e.find("input[name=variation_id]").val():0,e.on("reset_data",{GermanizedSingleProductWatcher:r},r.onResetVariation),e.on("found_variation.wc-variation-form",{GermanizedSingleProductWatcher:r},r.onFoundVariation)):r.productId=0<e.find("*[name=add-to-cart][type=submit]").length?e.find("*[name=add-to-cart][type=submit]").val():r.params.product_id}e.prototype.abortAjaxRequests=function(e){if(0<e.requests.length)for(var r=0;r<e.requests.length;r++)e.requests[r].abort()},e.prototype.onResetVariation=function(e){e.data.GermanizedSingleProductWatcher.variationId=0},e.prototype.onFoundVariation=function(e,r){e=e.data.GermanizedSingleProductWatcher;r.hasOwnProperty("variation_id")&&(e.variationId=r.variation_id)},e.prototype.getCurrentPriceData=function(e){var r=n(e.params.wrapper+" "+e.params.price_selector+":not(.price-unit):visible");if(0<r.length){var t=r.parents(e.params.wrapper).find(".price-unit:first"),i=e.getRawPrice(r.find(".amount:first"),e.params.price_decimal_sep),a="";if(1<r.find(".amount").length&&(a=e.getRawPrice(r.find(".amount:last"),e.params.price_decimal_sep)),0<t.length&&i)return{price:i,unit_price:t,sale_price:a}}return!1},e.prototype.onChangePrice=function(r){var t=r.data.GermanizedSingleProductWatcher;setTimeout(function(){var e=t.getCurrentPriceData(t);r.preventDefault(),e&&(t.$wrapper.find(t.params.price_selector+":not(.price-unit):visible").off("DOMSubtreeModified",{GermanizedSingleProductWatcher:t},t.onChangePrice),0<n.active?t.requests.length<=0&&n(i).on("ajaxStop",{GermanizedSingleProductWatcher:t},t.onAjaxStopRefresh):t.refreshUnitPrice(t,e.price,e.unit_price,e.sale_price))},500)},e.prototype.onAjaxStopRefresh=function(e){var r=e.data.GermanizedSingleProductWatcher,e=r.getCurrentPriceData(r);e&&r.refreshUnitPrice(r,e.price,e.unit_price,e.sale_price),n(i).off("ajaxStop",{GermanizedSingleProductWatcher:r},r.onAjaxStopRefresh)},e.prototype.getCurrentProductId=function(e){var r=e.productId;return 0<e.variationId&&(r=e.variationId),parseInt(r)},e.prototype.getRawPrice=function(r,e){var t=0<r.length?r.text():"",r=!1;try{r=accounting.unformat(t,e)}catch(e){r=!1}return r},e.prototype.refreshUnitPrice=function(r,e,t,i){r.abortAjaxRequests(r),r.requests.push(n.ajax({type:"POST",url:r.params.wc_ajax_url.toString().replace("%%endpoint%%","gzd_refresh_unit_price"),data:{security:r.params.refresh_unit_price_nonce,product_id:r.getCurrentProductId(r),price:e,price_sale:i},success:function(e){parseInt(e.product_id)===r.getCurrentProductId(r)&&e.hasOwnProperty("unit_price_html")&&t.html(e.unit_price_html),r.$wrapper.find(r.params.price_selector+":not(.price-unit):visible").on("DOMSubtreeModified",{GermanizedSingleProductWatcher:r},r.onChangePrice)},error:function(e){},dataType:"json"}))},n.fn.wc_germanized_single_product_watch=function(){return new e(this),this},n(function(){"undefined"!=typeof wc_gzd_single_product_params&&n(".variations_form, "+wc_gzd_single_product_params.wrapper+" .cart").each(function(){n(this).wc_germanized_single_product_watch()})})}(jQuery,(window,document)),window.germanized=window.germanized||{};