!function(a,i){function r(r){var e=this;e.$form=r,e.params=wc_gzd_single_product_params,e.$wrapper=r.closest(wc_gzd_single_product_params.wrapper),e.$product=r.closest(".product"),e.requests=[],e.observer=!1,e.timeout=!1,e.$wrapper.length<=0&&(e.$wrapper=e.$product),("MutationObserver"in i||"WebKitMutationObserver"in i||"MozMutationObserver"in i)&&(e.initObserver(e),r.hasClass("variations_form")?(e.productId=0<r.find("input[name=product_id]").length?r.find("input[name=product_id]").val():e.params.product_id,e.variatonId=0<r.find("input[name=variation_id]").length?r.find("input[name=variation_id]").val():0,r.on("reset_data",{GermanizedSingleProductWatcher:e},e.onResetVariation),r.on("found_variation.wc-variation-form",{GermanizedSingleProductWatcher:e},e.onFoundVariation)):e.productId=0<r.find("*[name=add-to-cart][type=submit]").length?r.find("*[name=add-to-cart][type=submit]").val():e.params.product_id)}r.prototype.initObserver=function(t){var r,e=t.$wrapper.find(t.params.price_selector+":not(.price-unit):visible");0<e.length&&!t.observer&&(r=function(r,e){t.timeout&&(clearTimeout(t.timeout),t.abortAjaxRequests(t)),t.timeout=setTimeout(function(){var r=t.getCurrentPriceData(t);r&&a.active<=0&&t.refreshUnitPrice(t,r.price,r.unit_price,r.sale_price)},500)},"MutationObserver"in i?t.observer=new i.MutationObserver(r):"WebKitMutationObserver"in i?t.observer=new i.WebKitMutationObserver(r):"MozMutationObserver"in i&&(t.observer=new i.MozMutationObserver(r)),t.observer.observe(e[0],{childList:!0,subtree:!0,characterData:!0}))},r.prototype.cancelObserver=function(r){r.observer&&(r.observer.disconnect(),r.observer=!1)},r.prototype.abortAjaxRequests=function(r){if(0<r.requests.length)for(var e=0;e<r.requests.length;e++)r.requests[e].abort()},r.prototype.onResetVariation=function(r){r.data.GermanizedSingleProductWatcher.variationId=0},r.prototype.onFoundVariation=function(r,e){r=r.data.GermanizedSingleProductWatcher;e.hasOwnProperty("variation_id")&&(r.variationId=e.variation_id)},r.prototype.getCurrentPriceData=function(r){var e=a(r.params.wrapper+" "+r.params.price_selector+":not(.price-unit):visible");if(0<e.length){var t=e.parents(r.params.wrapper).find(".price-unit:first"),i=r.getRawPrice(e.find(".amount:first"),r.params.price_decimal_sep),n="";if(1<e.find(".amount").length&&(n=r.getRawPrice(e.find(".amount:last"),r.params.price_decimal_sep)),0<t.length&&i)return{price:i,unit_price:t,sale_price:n}}return!1},r.prototype.getCurrentProductId=function(r){var e=r.productId;return 0<r.variationId&&(e=r.variationId),parseInt(e)},r.prototype.getRawPrice=function(e,r){var t=0<e.length?e.text():"",e=!1;try{e=accounting.unformat(t,r)}catch(r){e=!1}return e},r.prototype.refreshUnitPrice=function(e,r,t,i){e.abortAjaxRequests(e),e.requests.push(a.ajax({type:"POST",url:e.params.wc_ajax_url.toString().replace("%%endpoint%%","gzd_refresh_unit_price"),data:{security:e.params.refresh_unit_price_nonce,product_id:e.getCurrentProductId(e),price:r,price_sale:i},success:function(r){parseInt(r.product_id)===e.getCurrentProductId(e)&&r.hasOwnProperty("unit_price_html")&&t.html(r.unit_price_html)},error:function(r){},dataType:"json"}))},a.fn.wc_germanized_single_product_watch=function(){return new r(this),this},a(function(){"undefined"!=typeof wc_gzd_single_product_params&&a("form.variations_form, "+wc_gzd_single_product_params.wrapper+" form.cart").each(function(){a(this).wc_germanized_single_product_watch()})})}(jQuery,window,document),window.germanized=window.germanized||{};