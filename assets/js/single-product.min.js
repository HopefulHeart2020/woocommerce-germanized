window.germanized=window.germanized||{},function(a,o){o.single_product={params:{},requests:[],productId:0,variationId:0,init:function(){var e=o.single_product;e.params=wc_gzd_single_product_params,e.productId=e.params.product_id,a(e.params.wrapper+" "+e.params.price_selector+":not(.price-unit):visible").on("DOMSubtreeModified",e.onChangePrice),0<a(".variations_form").length&&a(".variations_form").each(function(){var r=a(this);r.on("reset_data",e.onResetVariation),r.on("found_variation.wc-variation-form",e.onFoundVariation)})},abortAjaxRequests:function(){var r=o.single_product;if(0<r.requests.length)for(var e=0;e<r.requests.length;e++)r.requests[e].abort()},onFoundVariation:function(r,e){var t=o.single_product;e.hasOwnProperty("variation_id")&&(t.variationId=e.variation_id)},onResetVariation:function(){o.single_product.variationId=0},getCurrentPriceData:function(){var r=o.single_product,e=a(r.params.wrapper+" "+r.params.price_selector+":not(.price-unit):visible");if(0<e.length){var t=e.parents(r.params.wrapper).find(".price-unit:first"),i=r.getRawPrice(e.find(".amount:first")),n="";if(1<e.find(".amount").length&&(n=r.getRawPrice(e.find(".amount:last"))),0<t.length&&i)return{price:i,unit_price:t,sale_price:n}}return!1},onChangePrice:function(e){var t=o.single_product;setTimeout(function(){var r=t.getCurrentPriceData();e.preventDefault(),r&&(a(t.params.wrapper+" "+t.params.price_selector+":not(.price-unit):visible").off("DOMSubtreeModified",t.onChangePrice),0<a.active?t.requests.length<=0&&a(document).on("ajaxStop",t.onAjaxStopRefresh):t.refreshUnitPrice(r.price,r.unit_price,r.sale_price))},500)},onAjaxStopRefresh:function(r){var e=o.single_product,t=e.getCurrentPriceData();t&&e.refreshUnitPrice(t.price,t.unit_price,t.sale_price),a(document).off("ajaxStop",e.onAjaxStopRefresh)},getCurrentProductId:function(){var r=o.single_product,e=r.productId;return 0<r.variationId&&(e=r.variationId),parseInt(e)},getRawPrice:function(e){var r=o.single_product,t=0<e.length?e.text():"",e=!1;try{e=accounting.unformat(t,r.params.price_decimal_sep)}catch(r){e=!1}return e},refreshUnitPrice:function(r,e,t){var i=o.single_product;i.abortAjaxRequests(),i.requests.push(a.ajax({type:"POST",url:i.params.wc_ajax_url.toString().replace("%%endpoint%%","gzd_refresh_unit_price"),data:{security:i.params.refresh_unit_price_nonce,product_id:0<i.variationId?i.variationId:i.productId,price:r,price_sale:t},success:function(r){parseInt(r.product_id)===i.getCurrentProductId()&&r.hasOwnProperty("unit_price_html")&&e.html(r.unit_price_html),a(i.params.wrapper+" "+i.params.price_selector+":not(.price-unit):visible").on("DOMSubtreeModified",i.onChangePrice)},error:function(r){},dataType:"json"}))}},a(document).ready(function(){o.single_product.init()})}(jQuery,window.germanized);